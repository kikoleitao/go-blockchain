# Simple Blockchain in Go

## Overview

This project is a simple blockchain implementation in Go, developed in two stages:

- **Part 1**: A basic blockchain structure linking blocks via hashes.
- **Part 2**: Adding Proof-of-Work (PoW) to secure block creation.

## Part 1: Basic Prototype

### Features

- A `Block` structure containing data, its hash, and the hash of the previous block.
- A `BlockChain` structure managing a list of blocks.
- A genesis block that starts the chain.
- Basic functionality to add new blocks linked through hashes.

Each block's hash is generated using SHA-256 over its `Data` and `PrevHash`.

### How It Works

- The blockchain is initialized with a **genesis block** (`"Genesis"` data).
- New blocks are added manually by calling `AddBlock(data)`, which:
  - References the previous block's hash.
  - Computes its own hash.
  - Appends the block to the chain.
- When run, the program prints the data, previous hash, and hash of each block in the chain.

### How to Run

```bash
# Initialize the Go module
go mod init github.com/kikoleitao/go-blockchain

# Run the main program
go run main.go
```

### Example Output (Part 1)

```bash
Previous Hash:
Data in Block: Genesis
Hash: 81ddc8d248b2dccdd3fdd5e84f0cad62b08f2d10b57f9a831c13451e5c5c80a5
Previous Hash: 81ddc8d248b2dccdd3fdd5e84f0cad62b08f2d10b57f9a831c13451e5c5c80a5
Data in Block: First Block after Genesis
Hash: 50493b76a2b7bec8d33620d6310d5578b1dda079684405ed5e6bd55510146daf
Previous Hash: 50493b76a2b7bec8d33620d6310d5578b1dda079684405ed5e6bd55510146daf
Data in Block: Second Block after Genesis
Hash: 213e91a4ae1be45a651695ede0e75cba50818dce027dd4f0fe35742dc90158e1
Previous Hash: 213e91a4ae1be45a651695ede0e75cba50818dce027dd4f0fe35742dc90158e1
Data in Block: Third Block after Genesis
Hash: e22b76962d23ed3e327b9ababac19270b56c4d70d8878446609b13fa72ebc0e1
```

---

## Part 2: Adding Proof-of-Work

### New Features

- Each block must satisfy a **Proof-of-Work** (PoW) before being added.
- A block is only valid if its hash is smaller than a target defined by a **difficulty** level.

### How Difficulty Works

- `Difficulty = 20` means that the hash must start with around **20 leading binary zeros**.
- In hexadecimal output, this looks like **5 leading zeros**.
- Technically, the valid hash must be **smaller than** `2^(256 - Difficulty)`.

Example:
```bash
Difficulty = 20
Target = 2^236
```

- Hashes are generated by iteratively incrementing a `nonce` until a valid hash is found.
- This process proves that **computational work** was done to mine the block.

### Example Output (Part 2)

```bash
Data in Block: Genesis
Previous Hash:
Hash: 00000e8654e72084186f93e1a49c3f71a11d342d489ba82edc078b8b5d4ca515
PoW Valid: true

Data in Block: First Block after Genesis
Previous Hash: 00000e8654e72084186f93e1a49c3f71a11d342d489ba82edc078b8b5d4ca515
Hash: 00000233d7cbce019901ae8ca225a499622765f2f2cb387e9d735d181c54647a
PoW Valid: true

Data in Block: Second Block after Genesis
Previous Hash: 00000233d7cbce019901ae8ca225a499622765f2f2cb387e9d735d181c54647a
Hash: 000000c5499421ed3a6d5b185d649bd13fee2517468cf18cd6136e6c8b5b0cb0
PoW Valid: true

Data in Block: Third Block after Genesis
Previous Hash: 000000c5499421ed3a6d5b185d649bd13fee2517468cf18cd6136e6c8b5b0cb0
Hash: 0000016a6d677525c30144c66fb892a5e9cfc0daaa4ea7aa84b3dff5994d626e
PoW Valid: true
```

---

## Part 3: Persistence and CLI

### New Features

- Blocks are now persisted to disk using BoltDB, ensuring the blockchain is saved between runs.
- A command-line interface (CLI) has been introduced for user interaction.

### How Persistence Works
- Instead of keeping the blockchain in memory, each block is stored in a BoltDB bucket.
- A special key ("l") keeps track of the latest block hash to allow appending new blocks efficiently.


### Example Output (Part 3)

This part showcases the blockchain with a simple **CLI interface** using commands to add and print blocks:

```bash
# First time running the blockchain: initializes and creates the genesis block
go run main.go print

No existing blockchain found
0000342dc11a9fd1833ed9fe18ca5627cedc56507de6698acfcafd301398cb35
Genesis created

Prev. hash: 
Data: Genesis
Hash: 0000342dc11a9fd1833ed9fe18ca5627cedc56507de6698acfcafd301398cb35
PoW: true
```


```bash
# Add a new block with custom data
go run main.go add -block "First Block"

00003917bfa9185f32ffec0c2e8403befb9f6b22387dd25627ab4a005a54d6d3
Added Block!
```

```bash
# Print the current blockchain state
go run main.go print

# Note: Reading from storage, so no PoW calculation is done

Prev. hash: 0000342dc11a9fd1833ed9fe18ca5627cedc56507de6698acfcafd301398cb35
Data: First Block
Hash: 00003917bfa9185f32ffec0c2e8403befb9f6b22387dd25627ab4a005a54d6d3
PoW: true

Prev. hash: 
Data: Genesis
Hash: 0000342dc11a9fd1833ed9fe18ca5627cedc56507de6698acfcafd301398cb35
PoW: true
```

```bash
# Add another block with sample transaction data
go run main.go add -block "Send 10 BTC to Bob"

0000012a3d9f8b6c1e86db86a900b469e09698de84f9bfad0dcaffbd00313fac
Added Block!
```


```bash
# Final blockchain state with all blocks
go run main.go print

Prev. hash: 00003917bfa9185f32ffec0c2e8403befb9f6b22387dd25627ab4a005a54d6d3
Data: Send 10 BTC to Bob
Hash: 0000012a3d9f8b6c1e86db86a900b469e09698de84f9bfad0dcaffbd00313fac
PoW: true

Prev. hash: 0000342dc11a9fd1833ed9fe18ca5627cedc56507de6698acfcafd301398cb35
Data: First Block
Hash: 00003917bfa9185f32ffec0c2e8403befb9f6b22387dd25627ab4a005a54d6d3
PoW: true

Prev. hash: 
Data: Genesis
Hash: 0000342dc11a9fd1833ed9fe18ca5627cedc56507de6698acfcafd301398cb35
PoW: true
```

### BadgerDB Files in `/tmp/blocks`

When running the blockchain, BadgerDB stores its internal data in various files in the `/tmp/blocks` directory. Below is an explanation of each file and its role:

#### `.sst` Files (e.g., `000001.sst`, `000002.sst`, etc.)
- **SST = Sorted String Table**
- These are **immutable** files that store key-value pairs in **sorted order**.
- They are created when a MemTable (in-memory data) is flushed to disk or during the compaction process.
- BadgerDB uses these files to provide fast lookups for data.

#### `.vlog` Files (e.g., `000005.vlog`, `000006.vlog`, etc.)
- **Value Log files**
- These files store **large value data**. While `.sst` files store keys, `.vlog` files store large associated values.
- When a key in a `.sst` file points to a large value, that value is stored in the `.vlog` file.
- These files are crucial for handling large data that doesn't fit into the `.sst` files.

#### `MANIFEST`
- The **Manifest** file tracks the **current state of the database**, including:
  - The versions of the tables.
  - Which tables are active.
  - Information about compactions and other internal operations.
- This file is critical to BadgerDB, and any corruption in it can prevent the database from starting.

#### `DISCARD`
- This file helps BadgerDB with **garbage collection** by tracking **discarded or obsolete vlog data**.
- The content of this file helps BadgerDB decide what data can be safely deleted to free up disk space.

#### `KEYREGISTRY`
- This file stores information about **data encryption keys** if encryption is enabled in the database.
- If encryption is not used, this file may still exist as a placeholder.

---
